<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaTí - De todo</title>
    <link href="styles/main.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/pocketbase@0.21.1/dist/pocketbase.umd.js"></script>
    <script src="scripts/lib/pocketbase.js" defer></script>
    <script src="scripts/app.js" defer></script>
</head>
<body>
    <!-- Contenido HTML -->
</body>
</html>


<body>
    <!-- Navbar -->
   <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">PaTí</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('home')">Inicio</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('products')">Productos</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('about')">Nosotros</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('contact')">Contactos</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="showStoreSelection()">Tiendas</a></li>
                    <button class="btn btn-outline-light" onclick="showAdminLogin()">
                        <i class="fas fa-cog"></i> Administrador
                    </button>
                </ul>
                <div class="d-none" id="authButtons">
                    <button class="btn btn-outline-light me-2" onclick="showLoginForm()">
                        <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                    </button>
                </div>
                <div class="d-none" id="logoutButton">
                    <button class="btn btn-outline-light" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Sections -->
    <div id="mainContent">
        <!-- Home Section -->
        <section id="homeSection">
            <div class="hero-section">
                <div class="hero-content">
                    <h1 class="display-4 fw-bold">Bienvenido a PaTí</h1>
                    <p class="lead">"De todo" para todos los gustos y necesidades</p>
                    <button class="btn btn-primary btn-lg me-3" onclick="showStoreSelection()">Entra a tu tienda ahora</button>
                    <button class="btn btn-outline-light btn-lg" onclick="showCreateStoreForm()">Monta tu tienda hoy</button>
                </div>
            </div>
            <div class="container mb-5">
                <div class="amazed-person">
                    <img src="https://cdn.b12.io/client_media/QxJcSkIK/ecb4925e-72e0-11f0-8eab-0242ac110002-jpeg-hero_image.jpeg" alt="Cliente asombrado">
                    <div>
                        <h3>¡Estoy asombrado!</h3>
                        <p>Nunca imaginé encontrar tantos productos de calidad en un solo lugar. PaTí tiene todo lo que necesito y a precios increíbles. ¡La entrega a domicilio es un servicio excelente!</p>
                        <button class="btn btn-primary mt-2" onclick="showStoreSelection()">Quiero comprar ahora</button>
                    </div>
                </div>
                <h2 class="text-center mb-4">Tiendas Destacadas</h2>
                <div class="row" id="featuredStores">
                    <!-- Featured stores will be loaded here -->
                </div>
            </div>
        </section>
        <!-- Products Section -->
        <section id="productsSection" class="container mb-5" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Nuestros Productos</h2>
            </div>
            <div class="row mb-4">
                <div class="col-md-6">
                    <input type="text" class="form-control" id="searchProduct" placeholder="Buscar productos..." onkeyup="filterProducts()">
                </div>
                <div class="col-md-6">
                    <select class="form-select" id="categoryFilter" onchange="filterProducts()">
                        <option value="">Todas las categorías</option>
                        <option value="C001">Electrónica</option>
                        <option value="C002">Hogar</option>
                        <option value="C003">Útiles y Herramientas</option>
                        <option value="C004">Ropas</option>
                        <option value="C005">Calzados</option>
                        <option value="C006">Deportiva</option>
                    </select>
                </div>
            </div>
            <div class="row" id="productsList">
            <!-- Products will be loaded here -->
            </div>
        </section>
        <!-- About Section -->
        <section id="aboutSection" class="container mb-5" style="display: none;">
            <div class="about-content">
                <h2 class="text-center mb-4">Acerca de PaTí</h2>
                <p>PaTí es tu plataforma de tiendas en línea donde encontrarás "de todo" para satisfacer todas tus necesidades. Nuestra misión es ofrecerte productos de calidad a precios accesibles con un servicio de entrega a domicilio rápido y confiable.</p>
                <div class="delivery-info">
                    <h4><i class="fas fa-truck"></i> Servicio de Entrega</h4>
                    <p>Ofrecemos entrega a domicilio en toda la ciudad. El costo de envío es de <span class="delivery-price">$2.50</span> para pedidos menores a <strong>$50</strong>. Para pedidos superiores a <strong>$50</strong>, el envío es <strong>GRATIS</strong>.</p>
                    <p>Nuestro horario de entregas es de lunes a sábado de 9:00 am a 8:00 pm.</p>
                </div>
                <h4 class="mt-4">Nuestra Historia</h4>
                <p>PaTí nació en 2020 con la visión de crear una plataforma de tiendas en línea que ofreciera una amplia variedad de productos para toda la familia. Desde nuestros humildes comienzos, hemos crecido gracias a la confianza de nuestros clientes y ahora contamos con cientos de productos en nuestro catálogo.</p>
                <h4 class="mt-4">¿Por qué elegirnos?</h4>
                <ul>
                    <li>Amplia variedad de productos de calidad</li>
                    <li>Precios competitivos</li>
                    <li>Entrega rápida y confiable</li>
                    <li>Atención al cliente excepcional</li>
                    <li>Programa de afiliados con atractivas comisiones</li>
                </ul>
            </div>
        </section>
        <!-- Contact Section -->
        <section id="contactSection" class="container mb-5" style="display: none;">
            <div class="about-content">
                <h2 class="text-center mb-4">Contáctanos</h2>
                <div class="row">
                    <div class="col-md-6">
                        <h4>Información de Contacto</h4>
                        <p><i class="fas fa-map-marker-alt"></i> Av. Principal #123, Ciudad</p>
                        <p><i class="fas fa-phone"></i> (123) 456-7890</p>
                        <p><i class="fas fa-envelope"></i> info@pati.com</p>
                        <p><i class="fas fa-clock"></i> Lunes a Sábado: 9:00 am - 8:00 pm</p>
                    </div>
                    <div class="col-md-6">
                        <h4>Envíanos un Mensaje</h4>
                        <form id="contactForm">
                            <div class="mb-3">
                                <input type="text" class="form-control" placeholder="Nombre" required>
                            </div>
                            <div class="mb-3">
                                <input type="email" class="form-control" placeholder="Correo electrónico" required>
                            </div>
                            <div class="mb-3">
                                <textarea class="form-control" rows="4" placeholder="Mensaje" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Enviar Mensaje</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        <!-- Store Selection Section -->
        <section id="storeSelectionSection" class="container mb-5" style="display: none;">
            <div class="about-content">
                <h2 class="text-center mb-4">Selecciona una Tienda</h2>
                <div class="row mb-4">
                    <div class="col-md-6">
                        <input type="text" class="form-control" id="searchStore" placeholder="Buscar tiendas..." onkeyup="filterStores()">
                    </div>
                    <div class="col-md-6">
                        <select class="form-select" id="categoryStoreFilter" onchange="filterStores()">
                            <option value="">Todas las categorías</option>
                            <option value="C001">Electrónica</option>
                            <option value="C002">Hogar</option>
                            <option value="C003">Útiles y Herramientas</option>
                            <option value="C004">Ropas</option>
                            <option value="C005">Calzados</option>
                            <option value="C006">Deportiva</option>
                        </select>
                    </div>
                </div>
                <div class="row" id="storesList">
                    <!-- Stores will be loaded here -->
                </div>
            </div>
        </section>
        <!-- Create Store Section -->
        <section id="createStoreSection" class="container mb-5" style="display: none;">
            <div class="about-content">
                <h2 class="text-center mb-4">Crea tu Tienda</h2>
                <form id="createStoreForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="storeName" class="form-label">Nombre de la Tienda</label>
                                <input type="text" class="form-control" id="storeName" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="storeCategory" class="form-label">Categoría Principal</label>
                                <select class="form-select" id="storeCategory" required>
                                    <option value="">Seleccionar categoría</option>
                                    <option value="C001">Electrónica</option>
                                    <option value="C002">Hogar</option>
                                    <option value="C003">Útiles y Herramientas</option>
                                    <option value="C004">Ropas</option>
                                    <option value="C005">Calzados</option>
                                    <option value="C006">Deportiva</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="adminName" class="form-label">Nombre del Administrador</label>
                                <input type="text" class="form-control" id="adminName" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="adminEmail" class="form-label">Correo del Administrador</label>
                                <input type="email" class="form-control" id="adminEmail" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="adminPassword" class="form-label">Contraseña</label>
                                <input type="password" class="form-control" id="adminPassword" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="adminPhone" class="form-label">Teléfono</label>
                                <input type="tel" class="form-control" id="adminPhone" required>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="storeDescription" class="form-label">Descripción de la Tienda</label>
                        <textarea class="form-control" id="storeDescription" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="storeImage" class="form-label">URL de Imagen Representativa</label>
                        <input type="url" class="form-control" id="storeImage">
                    </div>
                    <div class="mb-3">
                        <label for="storeLogo" class="form-label">URL del Logo de la Tienda (opcional)</label>
                        <input type="url" class="form-control" id="storeLogo">
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Crear Tienda</button>
                </form>
            </div>
        </section>
        <!-- Store Login Section -->
        <section id="storeLoginSection" class="container mb-5" style="display: none;">
            <div class="about-content">
                <h2 class="text-center mb-4">Iniciar Sesión en <span id="storeLoginName"></span></h2>
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="text-center mb-4">
                            <p>Selecciona tu tipo de cuenta para iniciar sesión</p>
                        </div>
                        <div class="d-flex flex-column align-items-center">
                            <button class="login-role-btn" onclick="showLoginForm('customer')">
                                <i class="fas fa-user me-2"></i> Cliente
                            </button>
                            <button class="login-role-btn" onclick="showLoginForm('affilate')">
                                <i class="fas fa-handshake me-2"></i> Afiliado
                            </button>
                            <button class="login-role-btn" onclick="showLoginForm('admin')">
                                <i class="fas fa-cog me-2"></i> Administrador
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Iniciar Sesión</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <input type="hidden" id="loginRole" value="customer">
                        <input type="hidden" id="loginStoreId" value="">
                        <div class="mb-3">
                            <label for="loginEmail" class="form-label">Correo electrónico</label>
                            <input type="email" class="form-control" id="loginEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">Contraseña</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="rememberMe">
                            <label class="form-check-label" for="rememberMe">Recordarme</label>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Iniciar Sesión</button>
                    </form>
                    <div class="text-center mt-3">
                        <a href="#" onclick="showRegisterForm()">¿No tienes cuenta? Regístrate</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Admin Login Modal -->
	<div class="modal fade" id="adminLoginModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Acceso Propietario</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<div class="mb-3">
						<label for="adminUsername" class="form-label">Usuario</label>
						<input type="text" class="form-control" id="adminUsername" placeholder="propietario" required>
					</div>
					<div class="mb-3">
						<label for="adminPassword" class="form-label">Contraseña</label>
						<input type="password" class="form-control" id="adminPassword" placeholder="propietario123" required>
					</div>
					<div class="d-grid">
						<button type="button" class="btn btn-primary" onclick="loginAsOwner()">Ingresar como Propietario</button>
					</div>
				</div>
			</div>
		</div>
	</div>
    <!-- Register Modal -->
    <div class="modal fade" id="registerModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Crear Cuenta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="registerForm">
                        <input type="hidden" id="registerRole" value="customer">
                        <input type="hidden" id="registerStoreId" value="">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="registerName" class="form-label">Nombre Completo</label>
                                    <input type="text" class="form-control" id="registerName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="registerEmail" class="form-label">Correo electrónico</label>
                                    <input type="email" class="form-control" id="registerEmail" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="registerPassword" class="form-label">Contraseña</label>
                                    <input type="password" class="form-control" id="registerPassword" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="registerConfirmPassword" class="form-label">Confirmar Contraseña</label>
                                    <input type="password" class="form-control" id="registerConfirmPassword" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="registerPhone" class="form-label">Teléfono</label>
                                    <input type="tel" class="form-control" id="registerPhone" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="registerAddress" class="form-label">Dirección</label>
                                    <input type="text" class="form-control" id="registerAddress" required>
                                </div>
                            </div>
                        </div>
                        <!-- Affiliate specific fields -->
                        <div id="affiliateFields" style="display: none;">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="affiliateCardUSD" class="form-label">Tarjeta USD</label>
                                        <input type="text" class="form-control" id="affiliateCardUSD" placeholder="Número de tarjeta">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="affiliateCardCUP" class="form-label">Tarjeta CUP</label>
                                        <input type="text" class="form-control" id="affiliateCardCUP" placeholder="Número de tarjeta">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Crear Cuenta</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Cart Offcanvas -->
    <div class="cart-icon" data-bs-toggle="offcanvas" data-bs-target="#cartOffcanvas">
        <i class="fas fa-shopping-cart fa-lg"></i>
        <span class="cart-badge" id="cartCount">0</span>
    </div>
    <!-- Cart Offcanvas -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="cartOffcanvas">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">Carrito de Compras</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <div id="cartItems">
                <!-- Cart items will be loaded here -->
            </div>
            <div class="mt-3">
                <h5>Total: <span id="cartTotal">$0.00</span></h5>
                <button class="btn btn-primary w-100 mt-3" onclick="checkout()">Realizar Pedido</button>
            </div>
        </div>
    </div>
    <!-- Add Store Modal -->
    <div class="modal fade" id="addStoreModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Agregar Tienda</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addStoreForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="newStoreName" class="form-label">Nombre de la Tienda</label>
                                    <input type="text" class="form-control" id="newStoreName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="newStoreCategory" class="form-label">Categoría Principal</label>
                                    <select class="form-select" id="newStoreCategory" required>
                                        <option value="">Seleccionar categoría</option>
                                        <option value="C001">Electrónica</option>
                                        <option value="C002">Hogar</option>
                                        <option value="C003">Útiles y Herramientas</option>
                                        <option value="C004">Ropas</option>
                                        <option value="C005">Calzados</option>
                                        <option value="C006">Deportiva</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="newAdminName" class="form-label">Nombre del Administrador</label>
                                    <input type="text" class="form-control" id="newAdminName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="newAdminEmail" class="form-label">Correo del Administrador</label>
                                    <input type="email" class="form-control" id="newAdminEmail" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="newAdminPassword" class="form-label">Contraseña</label>
                                    <input type="password" class="form-control" id="newAdminPassword" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="newAdminPhone" class="form-label">Teléfono</label>
                                    <input type="tel" class="form-control" id="newAdminPhone" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="newStoreDescription" class="form-label">Descripción de la Tienda</label>
                            <textarea class="form-control" id="newStoreDescription" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="newStoreImage" class="form-label">URL de Imagen Representativa</label>
                            <input type="url" class="form-control" id="newStoreImage">
                        </div>
                        <div class="mb-3">
                            <label for="newStoreLogo" class="form-label">URL del Logo de la Tienda (opcional)</label>
                            <input type="url" class="form-control" id="newStoreLogo">
                        </div>
                        <button type="submit" class="btn btn-primary">Crear Tienda</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Add Product Modal -->
    <div class="modal fade" id="addProductModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Agregar Producto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addProductForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productName" class="form-label">Nombre</label>
                                    <input type="text" class="form-control" id="productName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productStore" class="form-label">Tienda</label>
                                    <select class="form-select" id="productStore" required>
                                        <option value="">Seleccionar tienda</option>
                                        <!-- Stores will be loaded here -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productCategory" class="form-label">Categoría</label>
                                    <select class="form-select" id="productCategory" required>
                                        <option value="">Seleccionar categoría</option>
                                        <option value="C001">Electrónica</option>
                                        <option value="C002">Hogar</option>
                                        <option value="C003">Útiles y Herramientas</option>
                                        <option value="C004">Ropas</option>
                                        <option value="C005">Calzados</option>
                                        <option value="C006">Deportiva</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productStock" class="form-label">Stock</label>
                                    <input type="number" class="form-control" id="productStock" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Precios por Cantidad</label>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="input-group mb-3">
                                        <span class="input-group-text">1-10</span>
                                        <input type="number" step="0.01" class="form-control" id="productPrice1" placeholder="Precio" required>
                                        <span class="input-group-text">USD</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="input-group mb-3">
                                        <span class="input-group-text">11-50</span>
                                        <input type="number" step="0.01" class="form-control" id="productPrice2" placeholder="Precio" required>
                                        <span class="input-group-text">USD</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="input-group mb-3">
                                        <span class="input-group-text">51+</span>
                                        <input type="number" step="0.01" class="form-control" id="productPrice3" placeholder="Precio" required>
                                        <span class="input-group-text">USD</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="productDescription" class="form-label">Descripción</label>
                            <textarea class="form-control" id="productDescription" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="productImage" class="form-label">Imagen URL</label>
                            <input type="url" class="form-control" id="productImage">
                        </div>
                        <button type="submit" class="btn btn-primary">Guardar Producto</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Edit Commission Modal -->
    <div class="modal fade" id="editCommissionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Editar Comisión</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editCommissionForm">
                        <input type="hidden" id="editCommissionId">
                        <div class="mb-3">
                            <label for="editCommissionStore" class="form-label">Tienda</label>
                            <input type="text" class="form-control" id="editCommissionStore" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="editCommissionValue" class="form-label">Comisión (%)</label>
                            <input type="number" class="form-control" id="editCommissionValue" min="0" max="100" step="0.1" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveCommission()">Guardar Cambios</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Add Category Modal -->
    <div class="modal fade" id="addCategoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Agregar Categoría</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addCategoryForm">
                        <div class="mb-3">
                            <label for="categoryName" class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="categoryName" required>
                        </div>
                        <div class="mb-3">
                            <label for="categoryDescription" class="form-label">Descripción</label>
                            <textarea class="form-control" id="categoryDescription" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Guardar Categoría</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Add Affiliate Modal -->
    <div class="modal fade" id="addAffiliateModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Agregar Afiliado</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addAffiliateForm">
                        <div class="mb-3">
                            <label for="affiliateStore" class="form-label">Tienda</label>
                            <select class="form-select" id="affiliateStore" required>
                                <option value="">Seleccionar tienda</option>
                                <!-- Stores will be loaded here -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="affiliateName" class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="affiliateName" required>
                        </div>
                        <div class="mb-3">
                            <label for="affiliateEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="affiliateEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="affiliateCommission" class="form-label">Comisión (%)</label>
                            <input type="number" class="form-control" id="affiliateCommission" min="0" max="100" step="0.1" required>
                        </div>
                        <div class="mb-3">
                            <label for="affiliateStatus" class="form-label">Estado</label>
                            <select class="form-select" id="affiliateStatus" required>
                                <option value="Activo">Activo</option>
                                <option value="Inactivo">Inactivo</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Guardar Afiliado</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js "></script>
	<script src="scripts/app.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js "></script>
    <script>
        // ====== DATOS REALES DE TU EXCEL =====
        const categories = [
            { id: 'C001', name: 'Electrónica', description: '' },
            { id: 'C002', name: 'Hogar', description: '' },
            { id: 'C003', name: 'Útiles y Herramientas', description: '' },
            { id: 'C004', name: 'Ropas', description: '' },
            { id: 'C005', name: 'Calzados', description: '' },
            { id: 'C006', name: 'Deportiva', description: '' }
        ];
        let stores = [
            { id: 1, name: "TechZone", categoryId: 'C001', admin: "admin@techzone.com", status: "Activo", image: "https://images.unsplash.com/photo-1561154464-82e9adf327c?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80 ", description: "La mejor tecnología al mejor precio" },
            { id: 2, name: "FashionStyle", categoryId: 'C004', admin: "admin@fashionstyle.com", status: "Activo", image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80 ", description: "Moda para todos los estilos" },
            { id: 3, name: "HomeComfort", categoryId: 'C002', admin: "admin@homecomfort.com", status: "Inactivo", image: "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80 ", description: "Todo para tu hogar" },
            { id: 4, name: "SportsPro", categoryId: 'C006', admin: "admin@sportspro.com", status: "Activo", image: "https://images.unsplash.com/photo-1614632537197-38a17061c2bd?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80 ", description: "Equipamiento deportivo profesional" }
        ];
        let products = [
            { id: 1, name: "Smartphone XYZ", store: "TechZone", storeId: 1, categoryId: 'C001', price1: 299.99, price2: 279.99, price3: 259.99, stock: 15, image: "https://images.unsplash.com/photo-1511707171634-5f8a2d4e?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80 ", description: "El último smartphone con todas las características que necesitas." },
            { id: 2, name: "Auriculares Bluetooth", store: "TechZone", storeId: 1, categoryId: 'C001', price1: 49.99, price2: 44.99, price3: 39.99, stock: 30, image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80 ", description: "Auriculares inalámbricos con sonido de alta calidad." },
            { id: 3, name: "Camiseta Deportiva", store: "FashionStyle", storeId: 2, categoryId: 'C004', price1: 24.99, price2: 22.99, price3: 19.99, stock: 50, image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80 ", description: "Camiseta cómoda y transpirable para actividades deportivas." },
            { id: 4, name: "Juego de Sábanas", store: "HomeComfort", storeId: 3, categoryId: 'C002', price1: 39.99, price2: 36.99, price3: 34.99, stock: 20, image: "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80 ", description: "Juego de sábanas de algodón egipcio para una noche de sueño placentero." },
            { id: 5, name: "Balón de Fútbol", store: "SportsPro", storeId: 4, categoryId: 'C006', price1: 19.99, price2: 18.49, price3: 16.99, stock: 40, image: "https://images.unsplash.com/photo-1614632537197-38a17061c2bd?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80 ", description: "Balón oficial para partidos de fútbol profesional." },
            { id: 6, name: "Tablet ABC", store: "TechZone", storeId: 1, categoryId: 'C001', price1: 199.99, price2: 189.99, price3: 179.99, stock: 10, image: "https://images.unsplash.com/photo-1561154464-82e9adf327c?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80 ", description: "Tablet perfecta para trabajo y entretenimiento." },
            { id: 7, name: "Zapatillas Running", store: "SportsPro", storeId: 4, categoryId: 'C006', price1: 79.99, price2: 74.99, price3: 69.99, stock: 25, image: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80 ", description: "Zapatillas diseñadas para corredores profesionales." },
            { id: 8, name: "Cafetera Automática", store: "HomeComfort", storeId: 3, categoryId: 'C002', price1: 89.99, price2: 84.99, price3: 79.99, stock: 15, image: "https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80 ", description: "Cafetera programable para empezar el día con el mejor café." }
        ];
        const customers = [
            { id: 1, name: "Juan Pérez", email: "juan@email.com", phone: "123-456-7890", storeId: 1, store: "TechZone", orders: 5 },
            { id: 2, name: "María García", email: "maria@email.com", phone: "098-765-4321", storeId: 2, store: "FashionStyle", orders: 3 },
            { id: 3, name: "Carlos López", email: "carlos@email.com", phone: "555-123-4567", storeId: 3, store: "HomeComfort", orders: 7 }
        ];
        const affiliates = [
            { id: 1, name: "Ana Rodríguez", email: "ana@email.com", storeId: 1, store: "TechZone", commission: 15, sales: 24, status: "Activo" },
            { id: 2, name: "Pedro Martínez", email: "pedro@email.com", storeId: 2, store: "FashionStyle", commission: 12, sales: 18, status: "Activo" },
            { id: 3, name: "Laura Sánchez", email: "laura@email.com", storeId: 4, store: "SportsPro", commission: 10, sales: 12, status: "Inactivo" }
        ];
        const orders = [
            { id: 1001, customer: "Juan Pérez", storeId: 1, store: "TechZone", date: "2023-05-15", total: 149.97, status: "Entregado" },
            { id: 1002, customer: "María García", storeId: 2, store: "FashionStyle", date: "2023-05-16", total: 89.99, status: "En camino" },
            { id: 1003, customer: "Carlos López", storeId: 3, store: "HomeComfort", date: "2023-05-17", total: 299.99, status: "Procesando" }
        ];
        // Comisiones por tienda
        const storeCommissions = [
            { id: 1, storeId: 1, storeName: "TechZone", commission: 15 },
            { id: 2, storeId: 2, storeName: "FashionStyle", commission: 12 },
            { id: 3, storeId: 3, storeName: "HomeComfort", commission: 10 },
            { id: 4, storeId: 4, storeName: "SportsPro", commission: 18 }
        ];
        let cart = [];
        let currentUser = null;
        let isAdminLoggedIn = false;
        let currentStoreId = null;
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadFeaturedStores();
            setupEventListeners();
            initializeCharts();
        });
        function setupEventListeners() {
            // Admin login form
            const adminLoginForm = document.getElementById('adminLoginForm');
            if (adminLoginForm) {
                adminLoginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    adminLogin();
                });
            }
            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                userLogin();
            });
            // Register form
            document.getElementById('registerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                userRegister();
            });
            // Add store form
            document.getElementById('addStoreForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addStore();
            });
            // Create store form
            document.getElementById('createStoreForm').addEventListener('submit', function(e) {
                e.preventDefault();
                createStore();
            });
            // Add product form
            document.getElementById('addProductForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addProduct();
            });
            // Add category form
            document.getElementById('addCategoryForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addCategory();
            });
            // Add affiliate form
            document.getElementById('addAffiliateForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addAffiliate();
            });
            // Contact form
            document.getElementById('contactForm').addEventListener('submit', function(e) {
                e.preventDefault();
                alert('¡Gracias por tu mensaje! Te contactaremos pronto.');
                e.target.reset();
            });
            // Owner data form
            document.getElementById('ownerDataForm').addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Datos actualizados correctamente');
            });
            // Owner password form
            document.getElementById('ownerPasswordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmNewPassword').value;
                if (newPassword !== confirmPassword) {
                    alert('Las contraseñas no coinciden');
                    return;
                }
                alert('Contraseña cambiada correctamente');
                e.target.reset();
            });
            // Contact settings form
            document.getElementById('contactSettingsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Configuración de contacto actualizada correctamente');
            });
            // Custom report form
            document.getElementById('customReportForm').addEventListener('submit', function(e) {
                e.preventDefault();
                generateCustomReport();
            });
            // Register role change
            document.getElementById('registerRole').addEventListener('change', function() {
                const role = this.value;
                const affiliateFields = document.getElementById('affiliateFields');
                if (role === 'affiliate') {
                    affiliateFields.style.display = 'block';
                } else {
                    affiliateFields.style.display = 'none';
                }
            });
        }
        function showSection(section) {
            // Hide all sections
            document.getElementById('homeSection').style.display = 'none';
            document.getElementById('productsSection').style.display = 'none';
            document.getElementById('aboutSection').style.display = 'none';
            document.getElementById('contactSection').style.display = 'none';
            document.getElementById('storeSelectionSection').style.display = 'none';
            document.getElementById('createStoreSection').style.display = 'none';
            document.getElementById('storeLoginSection').style.display = 'none';
            // Show the selected section
            const sectionElement = document.getElementById(section + 'Section');
            if (sectionElement) {
                sectionElement.style.display = 'block';
            }
            // If products section, refresh the products list
            if (section === 'products') {
                loadProducts();
            }
        }
        function viewSite() {
            document.getElementById('adminPanel').classList.add('d-none');
            document.getElementById('mainContent').classList.remove('d-none');
            showSection('home');
        }
        function showStoreSelection() {
            showSection('storeSelection');
            loadStores();
        }
        function showCreateStoreForm() {
            showSection('createStore');
        }
        function showStoreLogin(storeId) {
            currentStoreId = storeId;
            const store = stores.find(s => s.id === storeId);
            if (store) {
                const storeLoginNameElement = document.getElementById('storeLoginName');
                if (storeLoginNameElement) {
                    storeLoginNameElement.textContent = store.name;
                }
            }
            showSection('storeLogin');
        }
        function showLoginForm(role = 'customer') {
            document.getElementById('loginRole').value = role;
            document.getElementById('loginStoreId').value = currentStoreId;
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            loginModal.show();
        }
        function showRegisterForm(role = 'customer') {
            document.getElementById('registerRole').value = role;
            document.getElementById('registerStoreId').value = currentStoreId;
            const affiliateFields = document.getElementById('affiliateFields');
            if (role === 'affiliate') {
                affiliateFields.style.display = 'block';
            } else {
                affiliateFields.style.display = 'none';
            }
            const registerModal = new bootstrap.Modal(document.getElementById('registerModal'));
            registerModal.show();
        }
        function showAdminLogin() {
			const adminLoginModal = document.getElementById('adminLoginModal');
			if (adminLoginModal) {
				const modal = new bootstrap.Modal(adminLoginModal);
				modal.show();
			}
		}
        function loadFeaturedStores() {
            const featuredStores = document.getElementById('featuredStores');
            featuredStores.innerHTML = '';
            const selected = stores.slice(0, 4);
            selected.forEach(store => {
                const storeCard = `
                    <div class="col-md-6 col-lg-3 mb-4">
                        <div class="card store-card h-100">
                            <img src="${store.image}" class="card-img-top" alt="${store.name}" style="height: 180px; object-fit: cover;">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">${store.name}</h5>
                                <p class="card-text flex-grow-1">${store.description}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="store-status ${store.status === 'Activo' ? 'status-active' : 'status-inactive'}">${store.status}</span>
                                    <button class="btn btn-primary" onclick="showStoreLogin(${store.id})">
                                        <i class="fas fa-sign-in-alt"></i> Entrar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                featuredStores.innerHTML += storeCard;
            });
        }
        function loadStores() {
            const storesList = document.getElementById('storesList');
            storesList.innerHTML = '';
            stores.forEach(store => {
                const category = categories.find(c => c.id === store.categoryId)?.name || 'Sin categoría';
                const storeCard = `
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card store-card h-100">
                            <img src="${store.image}" class="card-img-top" alt="${store.name}" style="height: 180px; object-fit: cover;">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">${store.name}</h5>
                                <p class="card-text flex-grow-1">${category}</p>
                                <p>${store.description || ''}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="store-status ${store.status === 'Activo' ? 'status-active' : 'status-inactive'}">${store.status}</span>
                                    <button class="btn btn-primary" onclick="showStoreLogin(${store.id})">
                                        <i class="fas fa-sign-in-alt"></i> Entrar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                storesList.innerHTML += storeCard;
            });
        }
        function filterStores() {
            const searchText = document.getElementById('searchStore').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryStoreFilter').value;
            const filteredStores = stores.filter(store => {
                const matchesSearch = store.name.toLowerCase().includes(searchText) || 
                                    store.description.toLowerCase().includes(searchText);
                const matchesCategory = categoryFilter === '' || store.categoryId === categoryFilter;
                return matchesSearch && matchesCategory;
            });
            const storesList = document.getElementById('storesList');
            storesList.innerHTML = '';
            filteredStores.forEach(store => {
                const category = categories.find(c => c.id === store.categoryId)?.name || 'Sin categoría';
                const storeCard = `
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card store-card h-100">
                            <img src="${store.image}" class="card-img-top" alt="${store.name}" style="height: 180px; object-fit: cover;">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">${store.name}</h5>
                                <p class="card-text flex-grow-1">${category}</p>
                                <p>${store.description || ''}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="store-status ${store.status === 'Activo' ? 'status-active' : 'status-inactive'}">${store.status}</span>
                                    <button class="btn btn-primary" onclick="showStoreLogin(${store.id})">
                                        <i class="fas fa-sign-in-alt"></i> Entrar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                storesList.innerHTML += storeCard;
            });
        }
        function loadProducts() {
            const productsList = document.getElementById('productsList');
            productsList.innerHTML = '';
            products.forEach(product => {
                const category = categories.find(c => c.id === product.categoryId)?.name || 'Sin categoría';
                const productCard = `
                    <div class="col-md-6 col-lg-4 col-xl-3 mb-4">
                        <div class="card product-card h-100">
                            <span class="category-badge badge bg-primary">${category}</span>
                            <img src="${product.image}" class="card-img-top product-image" alt="${product.name}">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">${product.name}</h5>
                                <p class="card-text flex-grow-1">${product.description}</p>
                                <div class="price-tier">
                                    <span>1-10: </span><span>$${product.price1.toFixed(2)}</span>
                                </div>
                                <div class="price-tier">
                                    <span>11-50: </span><span>$${product.price2.toFixed(2)}</span>
                                </div>
                                <div class="price-tier">
                                    <span>51+: </span><span>$${product.price3.toFixed(2)}</span>
                                </div>
                                <div class="quantity-control">
                                    <button type="button" onclick="decreaseQuantity(${product.id})">-</button>
                                    <input type="number" id="quantity-${product.id}" value="0" min="0" readonly>
                                    <button type="button" onclick="increaseQuantity(${product.id})">+</button>
                                </div>
                                <button class="btn btn-primary mt-2 w-100" onclick="addToCart(${product.id})">
                                    <i class="fas fa-cart-plus"></i> Agregar
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                productsList.innerHTML += productCard;
            });
        }
        function filterProducts() {
            const searchText = document.getElementById('searchProduct').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const filteredProducts = products.filter(product => {
                const matchesSearch = product.name.toLowerCase().includes(searchText) || 
                                    product.description.toLowerCase().includes(searchText);
                const matchesCategory = categoryFilter === '' || product.categoryId === categoryFilter;
                return matchesSearch && matchesCategory;
            });
            const productsList = document.getElementById('productsList');
            productsList.innerHTML = '';
            filteredProducts.forEach(product => {
                const category = categories.find(c => c.id === product.categoryId)?.name || 'Sin categoría';
                const productCard = `
                    <div class="col-md-6 col-lg-4 col-xl-3 mb-4">
                        <div class="card product-card h-100">
                            <span class="category-badge badge bg-primary">${category}</span>
                            <img src="${product.image}" class="card-img-top product-image" alt="${product.name}">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">${product.name}</h5>
                                <p class="card-text flex-grow-1">${product.description}</p>
                                <div class="price-tier">
                                    <span>1-10: </span><span>$${product.price1.toFixed(2)}</span>
                                </div>
                                <div class="price-tier">
                                    <span>11-50: </span><span>$${product.price2.toFixed(2)}</span>
                                </div>
                                <div class="price-tier">
                                    <span>51+: </span><span>$$${product.price3.toFixed(2)}</span>
                                </div>
                                <div class="quantity-control">
                                    <button type="button" onclick="decreaseQuantity(${product.id})">-</button>
                                    <input type="number" id="quantity-${product.id}" value="0" min="0" readonly>
                                    <button type="button" onclick="increaseQuantity(${product.id})">+</button>
                                </div>
                                <button class="btn btn-primary mt-2 w-100" onclick="addToCart(${product.id})">
                                    <i class="fas fa-cart-plus"></i> Agregar
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                productsList.innerHTML += productCard;
            });
        }
        function increaseQuantity(productId) {
            const quantityInput = document.getElementById(`quantity-${productId}`);
            const currentValue = parseInt(quantityInput.value);
            quantityInput.value = currentValue + 1;
        }
        function decreaseQuantity(productId) {
            const quantityInput = document.getElementById(`quantity-${productId}`);
            const currentValue = parseInt(quantityInput.value);
            if (currentValue > 0) {
                quantityInput.value = currentValue - 1;
            }
        }
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            const quantity = parseInt(document.getElementById(`quantity-${productId}`).value);
            if (product && quantity > 0) {
                let price;
                if (quantity >= 51) {
                    price = product.price3;
                } else if (quantity >= 11) {
                    price = product.price2;
                } else {
                    price = product.price1;
                }
                const existingItem = cart.find(item => item.id === productId);
                if (existingItem) {
                    existingItem.quantity += quantity;
                } else {
                    cart.push({ 
                        ...product, 
                        quantity: quantity,
                        unitPrice: price
                    });
                }
                document.getElementById(`quantity-${productId}`).value = 0;
                updateCart();
                showNotification(`${product.name} agregado al carrito`);
            } else {
                alert('Por favor, selecciona una cantidad mayor a cero');
            }
        }
        function updateCart() {
            const cartCount = document.getElementById('cartCount');
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            cartCount.textContent = cart.reduce((total, item) => total + item.quantity, 0);
            cartItems.innerHTML = '';
            let total = 0;
            cart.forEach(item => {
                const itemTotal = item.unitPrice * item.quantity;
                total += itemTotal;
                const cartItem = `
                    <div class="card mb-2">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="my-0">${item.name}</h6>
                                    <small class="text-muted">$${item.unitPrice.toFixed(2)} x ${item.quantity}</small>
                                </div>
                                <div class="d-flex align-items-center">
                                    <span class="text-muted">$$${itemTotal.toFixed(2)}</span>
                                    <button class="btn btn-sm btn-outline-danger ms-2" onclick="removeFromCart(${item.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                cartItems.innerHTML += cartItem;
            });
            cartTotal.textContent = `$${total.toFixed(2)}`;
        }
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCart();
        }
        function checkout() {
            if (cart.length === 0) {
                alert('Tu carrito está vacío. Agrega algunos productos antes de realizar el pedido.');
                return;
            }
            alert('¡Pedido realizado con éxito! Pronto nos comunicaremos contigo para coordinar la entrega.');
            cart = [];
            updateCart();
            const offcanvas = document.getElementById('cartOffcanvas');
            const bsOffcanvas = bootstrap.Offcanvas.getInstance(offcanvas);
            bsOffcanvas.hide();
        }
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'position-fixed bottom-5 end-0 m-3 alert alert-success alert-dismissible fade show';
            notification.style.zIndex = '1050';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(notification);
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        function userLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const role = document.getElementById('loginRole').value;
            const storeId = parseInt(document.getElementById('loginStoreId').value);
            if (email && password) {
                currentUser = {
                    id: Date.now(),
                    email,
                    role,
                    storeId
                };
                document.getElementById('authButtons').classList.add('d-none');
                document.getElementById('logoutButton').classList.remove('d-none');
                const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                loginModal.hide();
                if (role === 'admin') {
                    isAdminLoggedIn = true;
                    document.getElementById('mainContent').classList.add('d-none');
                    document.getElementById('adminPanel').classList.remove('d-none');
                    loadAdminData();
                    showNotification('Has iniciado sesión como administrador de la tienda');
                } else {
                    showSection('products');
                    showNotification(`Has iniciado sesión como ${role}`);
                }
            } else {
                alert('Por favor, ingresa tus credenciales');
            }
        }
        function userRegister() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const role = document.getElementById('registerRole').value;
            const storeId = parseInt(document.getElementById('registerStoreId').value);
            if (password !== confirmPassword) {
                alert('Las contraseñas no coinciden');
                return;
            }
            if (name && email && password) {
                currentUser = {
                    id: Date.now(),
                    name,
                    email,
                    role,
                    storeId
                };
                document.getElementById('authButtons').classList.add('d-none');
                document.getElementById('logoutButton').classList.remove('d-none');
                const registerModal = bootstrap.Modal.getInstance(document.getElementById('registerModal'));
                registerModal.hide();
                showSection('products');
                showNotification(`Tu cuenta ha sido creada correctamente. Has iniciado sesión como ${role}`);
            } else {
                alert('Por favor, completa todos los campos');
            }
        }
        // ✅ CORRECCIÓN: Función adminLogin mejorada
        function adminLogin() {
			const username = document.getElementById('adminUsername').value.trim();
			const password = document.getElementById('adminPassword').value.trim();
			if (username === 'propietario' && password === 'propietario123') {
				isAdminLoggedIn = true;
				currentUser = {
					id: 1, 
					name: 'Propietario',
					email: 'propietario@pati.com',
					role: 'propietario'
				};
				document.getElementById('mainContent').classList.add('d-none');
				document.getElementById('adminPanel').classList.remove('d-none');
				document.getElementById('authButtons').classList.add('d-none');
				document.getElementById('logoutButton').classList.remove('d-none');
				const modal = bootstrap.Modal.getInstance(document.getElementById('adminLoginModal'));
				if (modal) modal.hide();
				loadAdminData();
				showNotification('Has iniciado sesión como Propietario');
			} else {
				alert('Credenciales incorrectas.\nUsuario: propietario\nContraseña: propietario123');
			}
		}
        function logout() {
            currentUser = null;
            isAdminLoggedIn = false;
            currentStoreId = null;
            cart = [];
            updateCart();
            document.getElementById('mainContent').classList.remove('d-none');
            document.getElementById('adminPanel').classList.add('d-none');
            document.getElementById('authButtons').classList.remove('d-none');
            document.getElementById('logoutButton').classList.add('d-none');
            showSection('home');
            showNotification('Has cerrado sesión correctamente');
        }
        function createStore() {
            const storeName = document.getElementById('storeName').value;
            const storeCategory = document.getElementById('storeCategory').value;
            const adminName = document.getElementById('adminName').value;
            const adminEmail = document.getElementById('adminEmail').value;
            const adminPassword = document.getElementById('adminPassword').value;
            const adminPhone = document.getElementById('adminPhone').value;
            const storeDescription = document.getElementById('storeDescription').value;
            const storeImage = document.getElementById('storeImage').value || 'https://images.unsplash.com/photo-1607082348824-0a96f2a4b9da?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80 ';
            const storeLogo = document.getElementById('storeLogo').value;
            const newId = stores.length > 0 ? Math.max(...stores.map(s => s.id)) + 1 : 1;
            stores.push({
                id: newId,
                name: storeName,
                categoryId: storeCategory,
                admin: adminEmail,
                status: "Activo",
                image: storeImage,
                logo: storeLogo,
                description: storeDescription
            });
            document.getElementById('createStoreForm').reset();
            alert(`Tienda "${storeName}" creada correctamente. El administrador ha sido notificado.`);
            showSection('home');
        }
        function showAdminTab(tabId) {
            const tabs = document.querySelectorAll('.admin-tab-content');
            tabs.forEach(tab => tab.style.display = 'none');
            const menuItems = document.querySelectorAll('.admin-menu-item');
            menuItems.forEach(item => item.classList.remove('active'));
            const selectedTab = document.getElementById(tabId);
            if (selectedTab) {
                selectedTab.style.display = 'block';
            }
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
        }
        function loadAdminData() {
            const isOwner = currentUser && currentUser.role === 'propietario';
            const isAdmin = currentUser && currentUser.role === 'admin';
            const currentStoreId = isAdmin ? currentUser.storeId : null;
            // Filtrar datos SOLO para admin de tienda
            const filteredProducts = isOwner ? products : products.filter(p => p.storeId === currentStoreId);
            const filteredCustomers = isOwner ? customers : customers.filter(c => c.storeId === currentStoreId);
            const filteredAffiliates = isOwner ? affiliates : affiliates.filter(a => a.storeId === currentStoreId);
            const filteredOrders = isOwner ? orders : orders.filter(o => o.storeId === currentStoreId);
            // Cargar tablas
            if (isOwner) {
                loadAdminStores(); // Solo el propietario ve tiendas
            }
            loadAdminProducts(filteredProducts);
            loadAdminCategories();
            loadAdminCustomers(filteredCustomers);
            loadAdminAffiliates(filteredAffiliates);
            loadAdminOrders(filteredOrders);
            // Menú dinámico
            const menu = document.getElementById('adminMenu');
            if (isOwner) {
                menu.innerHTML = `
                    <div class="admin-menu-item active" onclick="showAdminTab('adminDashboardTab')">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </div>
                    <div class="admin-menu-item" onclick="showAdminTab('adminStoresTab')">
                        <i class="fas fa-store"></i> Tiendas
                    </div>
                    <div class="admin-menu-item" onclick="showAdminTab('adminCategoriesTab')">
                        <i class="fas fa-tags"></i> Categorías
                    </div>
                    <div class="admin-menu-item" onclick="showAdminTab('adminCommissionsTab')">
                        <i class="fas fa-percentage"></i> Comisiones
                    </div>
                    <div class="admin-menu-item" onclick="showAdminTab('adminReportsTab')">
                        <i class="fas fa-chart-bar"></i> Informes
                    </div>
                    <div class="admin-menu-item" onclick="showAdminTab('adminSettingsTab')">
                        <i class="fas fa-cog"></i> Configuración
                    </div>
                `;
            } else if (isAdmin) {
                menu.innerHTML = `
                    <div class="admin-menu-item active" onclick="showAdminTab('adminDashboardTab')">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </div>
                    <div class="admin-menu-item" onclick="showAdminTab('adminCategoriesTab')">
                        <i class="fas fa-tags"></i> Categorías
                    </div>
                    <div class="admin-menu-item" onclick="showAdminTab('adminProductsTab')">
                        <i class="fas fa-box"></i> Productos
                    </div>
                    <div class="admin-menu-item" onclick="showAdminTab('adminCustomersTab')">
                        <i class="fas fa-users"></i> Clientes
                    </div>
                    <div class="admin-menu-item" onclick="showAdminTab('adminAffiliatesTab')">
                        <i class="fas fa-handshake"></i> Afiliados
                    </div>
                    <div class="admin-menu-item" onclick="showAdminTab('adminOrdersTab')">
                        <i class="fas fa-shopping-cart"></i> Pedidos
                    </div>
                    <div class="admin-menu-item" onclick="showAdminTab('adminReportsTab')">
                        <i class="fas fa-chart-bar"></i> Reportes
                    </div>
                    <div class="admin-menu-item" onclick="showAdminTab('adminImportsTab')">
                        <i class="fas fa-file-import"></i> Importar Datos
                    </div>
                    <div class="admin-menu-item" onclick="showAdminTab('adminSettingsTab')">
                        <i class="fas fa-cog"></i> Configuración
                    </div>
                `;
            }
            // Actualizar título
            if (isOwner) {
                document.getElementById('adminPanelTitle').textContent = 'Panel del Propietario';
                document.getElementById('adminPanelHeader').textContent = 'Panel del Propietario - PaTí';
                document.getElementById('viewSiteButton').style.display = 'inline-block';
            } else if (isAdmin) {
                const store = stores.find(s => s.id === currentStoreId);
                const storeName = store ? store.name : 'Tienda';
                document.getElementById('adminPanelTitle').textContent = `Admin: ${storeName}`;
                document.getElementById('adminPanelHeader').textContent = `Administración de Tienda - ${storeName}`;
                document.getElementById('viewSiteButton').style.display = 'none';
            }
            // Actualizar dashboard
            const dashboardCards = document.querySelectorAll('#adminDashboardTab .summary-value');
            if (dashboardCards.length >= 4) {
                if (isOwner) {
                    dashboardCards[0].textContent = stores.length; // Tiendas → ahora solo para propietario
                    dashboardCards[1].textContent = products.length;
                    dashboardCards[2].textContent = customers.length;
                    dashboardCards[3].textContent = affiliates.length;
                } else if (isAdmin) {
                    const storeCategories = [...new Set(filteredProducts.map(p => p.categoryId))].length;
                    dashboardCards[0].textContent = storeCategories; // Categorías
                    dashboardCards[1].textContent = filteredProducts.length; // Productos
                    dashboardCards[2].textContent = filteredCustomers.length; // Clientes
                    dashboardCards[3].textContent = filteredAffiliates.length; // Afiliados
                }
                // Pedidos Hoy y Ventas Hoy (índices 4 y 5)
                dashboardCards[4].textContent = filteredOrders.length;
                const salesToday = filteredOrders.reduce((sum, o) => sum + o.total, 0);
                dashboardCards[5].textContent = '$' + salesToday.toFixed(2);
            }
            showAdminTab('adminDashboardTab');
        }
        function loadAdminStores() {
            const tableBody = document.getElementById('adminStoresTable');
            tableBody.innerHTML = '';
            stores.forEach(store => {
                const category = categories.find(c => c.id === store.categoryId)?.name || 'Sin categoría';
                const row = `
                    <tr>
                        <td>${store.id}</td>
                        <td>${store.name}</td>
                        <td>${category}</td>
                        <td>${store.admin}</td>
                        <td><span class="badge ${store.status === 'Activo' ? 'bg-success' : 'bg-secondary'}">${store.status}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-info" onclick="viewStore(${store.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editStore(${store.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm ${store.status === 'Activo' ? 'bg-secondary' : 'bg-success'}" onclick="toggleStoreStatus(${store.id})">
                                <i class="fas ${store.status === 'Activo' ? 'fa-pause' : 'fa-play'}"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteStore(${store.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }
        function loadAdminProducts(filteredProducts) {
            const tableBody = document.getElementById('adminProductsTable');
            tableBody.innerHTML = '';
            filteredProducts.forEach(product => {
                const category = categories.find(c => c.id === product.categoryId)?.name || 'Sin categoría';
                const row = `
                    <tr>
                        <td>${product.id}</td>
                        <td>${product.name}</td>
                        <td>${product.store}</td>
                        <td>${category}</td>
                        <td>
                            <div>1-10: $${product.price1.toFixed(2)}</div>
                            <div>11-50: $${product.price2.toFixed(2)}</div>
                            <div>51+: $${product.price3.toFixed(2)}</div>
                        </td>
                        <td>${product.stock}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-info" onclick="viewProduct(${product.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editProduct(${product.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${product.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }
        function loadAdminCategories() {
            const tableBody = document.getElementById('adminCategoriesTable');
            tableBody.innerHTML = '';
            categories.forEach(category => {
                const productCount = products.filter(p => p.categoryId === category.id).length;
                const row = `
                    <tr>
                        <td>${category.id}</td>
                        <td>${category.name}</td>
                        <td>${category.description}</td>
                        <td>${productCount}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-info" onclick="viewCategory(${category.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editCategory(${category.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteCategory(${category.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }
        function loadAdminCustomers(filteredCustomers) {
            const tableBody = document.getElementById('adminCustomersTable');
            tableBody.innerHTML = '';
            filteredCustomers.forEach(customer => {
                const row = `
                    <tr>
                        <td>${customer.id}</td>
                        <td>${customer.name}</td>
                        <td>${customer.email}</td>
                        <td>${customer.store}</td>
                        <td>${customer.orders}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-info" onclick="viewCustomer(${customer.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editCustomer(${customer.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteCustomer(${customer.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }
        function loadAdminAffiliates(filteredAffiliates) {
            const tableBody = document.getElementById('adminAffiliatesTable');
            tableBody.innerHTML = '';
            filteredAffiliates.forEach(affiliate => {
                const row = `
                    <tr>
                        <td>${affiliate.id}</td>
                        <td>${affiliate.name}</td>
                        <td>${affiliate.email}</td>
                        <td>${affiliate.store}</td>
                        <td>${affiliate.commission}%</td>
                        <td>${affiliate.sales}</td>
                        <td><span class="badge ${affiliate.status === 'Activo' ? 'bg-success' : 'bg-secondary'}">${affiliate.status}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-info" onclick="viewAffiliate(${affiliate.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editAffiliate(${affiliate.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteAffiliate(${affiliate.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }
        function loadAdminOrders(filteredOrders) {
            const tableBody = document.getElementById('adminOrdersTable');
            tableBody.innerHTML = '';
            orders.forEach(order => {
                const statusClass = 
                    order.status === 'Entregado' ? 'bg-success' :
                    order.status === 'En camino' ? 'bg-warning' :
                    order.status === 'Procesando' ? 'bg-info' : 'bg-secondary';
                const row = `
                    <tr>
                        <td>#${order.id}</td>
                        <td>${order.customer}</td>
                        <td>${order.store}</td>
                        <td>${order.date}</td>
                        <td>$${order.total.toFixed(2)}</td>
                        <td><span class="badge ${statusClass}">${order.status}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-info" onclick="viewOrder(${order.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="editOrder(${order.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }
        function loadAdminCommissions() {
            const tableBody = document.getElementById('adminCommissionsTable');
            if (!tableBody) return;
            tableBody.innerHTML = '';
            storeCommissions.forEach(commission => {
                const row = `
                    <tr>
                        <td>${commission.id}</td>
                        <td>${commission.storeName}</td>
                        <td>${commission.commission}%</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-warning" onclick="editCommission(${commission.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }
        function editCommission(commissionId) {
            const commission = storeCommissions.find(c => c.id === commissionId);
            if (commission) {
                document.getElementById('editCommissionId').value = commission.id;
                document.getElementById('editCommissionStore').value = commission.storeName;
                document.getElementById('editCommissionValue').value = commission.commission;
                const editCommissionModal = new bootstrap.Modal(document.getElementById('editCommissionModal'));
                editCommissionModal.show();
            }
        }
        function saveCommission() {
            const commissionId = parseInt(document.getElementById('editCommissionId').value);
            const commissionValue = parseFloat(document.getElementById('editCommissionValue').value);
            const commission = storeCommissions.find(c => c.id === commissionId);
            if (commission) {
                commission.commission = commissionValue;
                loadAdminCommissions();
                const editCommissionModal = bootstrap.Modal.getInstance(document.getElementById('editCommissionModal'));
                editCommissionModal.hide();
                showNotification('Comisión actualizada correctamente');
            }
        }
        function populateStoreSelects() {
            const selects = [
                'productStore',
                'affiliateStore',
                'editProductStore',
                'editCustomerStore',
                'editAffiliateStore',
                'editOrderStore'
            ];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Seleccionar tienda</option>';
                    stores.forEach(store => {
                        const option = document.createElement('option');
                        option.value = store.id;
                        option.textContent = store.name;
                        select.appendChild(option);
                    });
                }
            });
        }
        function addStore() {
            const name = document.getElementById('newStoreName').value;
            const category = document.getElementById('newStoreCategory').value;
            const adminName = document.getElementById('newAdminName').value;
            const adminEmail = document.getElementById('newAdminEmail').value;
            const adminPassword = document.getElementById('newAdminPassword').value;
            const adminPhone = document.getElementById('newAdminPhone').value;
            const description = document.getElementById('newStoreDescription').value;
            const image = document.getElementById('newStoreImage').value || 'https://images.unsplash.com/photo-1607082348824-0a96f2a4b9da?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80 ';
            const logo = document.getElementById('newStoreLogo').value;
            const newId = stores.length > 0 ? Math.max(...stores.map(s => s.id)) + 1 : 1;
            stores.push({
                id: newId,
                name,
                categoryId: category,
                admin: adminEmail,
                status: "Activo",
                image,
                logo,
                description
            });
            loadAdminStores();
            populateStoreSelects();
            const modal = bootstrap.Modal.getInstance(document.getElementById('addStoreModal'));
            modal.hide();
            document.getElementById('addStoreForm').reset();
            showNotification('Tienda agregada correctamente');
        }
        function addProduct() {
            const name = document.getElementById('productName').value;
            const storeId = parseInt(document.getElementById('productStore').value);
            const store = stores.find(s => s.id === storeId);
            const category = document.getElementById('productCategory').value;
            const price1 = parseFloat(document.getElementById('productPrice1').value);
            const price2 = parseFloat(document.getElementById('productPrice2').value);
            const price3 = parseFloat(document.getElementById('productPrice3').value);
            const stock = parseInt(document.getElementById('productStock').value);
            const description = document.getElementById('productDescription').value;
            const image = document.getElementById('productImage').value || 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80 ';
            const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
            products.push({
                id: newId,
                name,
                store: store.name,
                storeId,
                categoryId: category,
                price1,
                price2,
                price3,
                stock,
                description,
                image
            });
            loadAdminProducts();
            const modal = bootstrap.Modal.getInstance(document.getElementById('addProductModal'));
            modal.hide();
            document.getElementById('addProductForm').reset();
            showNotification('Producto agregado correctamente');
        }
        function addCategory() {
            const name = document.getElementById('categoryName').value;
            const description = document.getElementById('categoryDescription').value;
            const newId = categories.length > 0 ? Math.max(...categories.map(c => c.id)) + 1 : 1;
            categories.push({
                id: newId,
                name,
                description
            });
            loadAdminCategories();
            const modal = bootstrap.Modal.getInstance(document.getElementById('addCategoryModal'));
            modal.hide();
            document.getElementById('addCategoryForm').reset();
            showNotification('Categoría agregada correctamente');
        }
        function addAffiliate() {
            const storeId = parseInt(document.getElementById('affiliateStore').value);
            const store = stores.find(s => s.id === storeId);
            const name = document.getElementById('affiliateName').value;
            const email = document.getElementById('affiliateEmail').value;
            const commission = parseFloat(document.getElementById('affiliateCommission').value);
            const status = document.getElementById('affiliateStatus').value;
            const newId = affiliates.length > 0 ? Math.max(...affiliates.map(a => a.id)) + 1 : 1;
            affiliates.push({
                id: newId,
                name,
                email,
                storeId,
                store: store.name,
                commission,
                sales: 0,
                status
            });
            loadAdminAffiliates();
            const modal = bootstrap.Modal.getInstance(document.getElementById('addAffiliateModal'));
            modal.hide();
            document.getElementById('addAffiliateForm').reset();
            showNotification('Afiliado agregado correctamente');
        }
        function toggleStoreStatus(storeId) {
            if (confirm('¿Estás seguro de que quieres eliminar esta tienda? Esta acción no se puede deshacer.')) {
                const index = stores.findIndex(s => s.id === storeId);
                if (index !== -1) {
                    const storeName = stores[index].name;
                    stores.splice(index, 1);
                    for (let i = products.length - 1; i >= 0; i--) {
                        if (products[i].storeId === storeId) {
                            products.splice(i, 1);
                        }
                    }
                    for (let i = affiliates.length - 1; i >= 0; i--) {
                        if (affiliates[i].storeId === storeId) {
                            affiliates.splice(i, 1);
                        }
                    }
                    loadAdminStores();
                    loadAdminProducts();
                    loadAdminAffiliates();
                    populateStoreSelects();
                    showNotification(`Tienda ${storeName} eliminada correctamente`);
                }
            }
        }
        function deleteProduct(id) {
            if (confirm('¿Estás seguro de que quieres eliminar este producto?')) {
                const index = products.findIndex(p => p.id === id);
                if (index !== -1) {
                    products.splice(index, 1);
                    loadAdminProducts();
                    showNotification('Producto eliminado correctamente');
                }
            }
        }
        function deleteCategory(id) {
            if (confirm('¿Estás seguro de que quieres eliminar esta categoría?')) {
                const index = categories.findIndex(c => c.id === id);
                if (index !== -1) {
                    categories.splice(index, 1);
                    loadAdminCategories();
                    showNotification('Categoría eliminada correctamente');
                }
            }
        }
        function deleteCustomer(id) {
            if (confirm('¿Estás seguro de que quieres eliminar este cliente?')) {
                const index = customers.findIndex(c => c.id === id);
                if (index !== - 1) {
                    customers.splice(index, 1);
                    loadAdminCustomers();
                    showNotification('Cliente eliminado correctamente');
                }
            }
        }
        function deleteAffiliate(id) {
            if (confirm('¿Estás seguro de que quieres eliminar este afiliado?')) {
                const index = affiliates.findIndex(a => a.id === id);
                if (index !== - 1) {
                    affiliates.splice(index, 1);
                    loadAdminAffiliates();
                    showNotification('Afiliado eliminado correctamente');
                }
            }
        }
        function viewStore(storeId) {
            const store = stores.find(s => s.id === storeId);
            if (store) {
                const viewStoreModal = document.getElementById('viewStoreModal');
                if (viewStoreModal) {
                    document.getElementById('viewStoreName').textContent = store.name;
                    document.getElementById('viewStoreCategory').textContent = categories.find(c => c.id === store.categoryId)?.name || 'Sin categoría';
                    document.getElementById('viewStoreAdmin').textContent = store.admin;
                    document.getElementById('viewStoreStatus').textContent = store.status;
                    document.getElementById('viewStoreDescription').textContent = store.description;
                    document.getElementById('viewStoreImage').src = store.image;
                    const modal = new bootstrap.Modal(viewStoreModal);
                    modal.show();
                }
            }
        }
        function editStore(storeId) {
            const store = stores.find(s => s.id === storeId);
            if (store) {
                const editStoreModal = document.getElementById('editStoreModal');
                if (editStoreModal) {
                    document.getElementById('editStoreId').value = store.id;
                    document.getElementById('editStoreName').value = store.name;
                    document.getElementById('editStoreCategory').value = store.categoryId;
                    document.getElementById('editStoreAdmin').value = store.admin;
                    document.getElementById('editStoreStatus').value = store.status;
                    document.getElementById('editStoreDescription').value = store.description;
                    document.getElementById('editStoreImage').value = store.image;
                    const modal = new bootstrap.Modal(editStoreModal);
                    modal.show();
                }
            }
        }
        function saveStore() {
            const storeId = parseInt(document.getElementById('editStoreId').value);
            const store = stores.find(s => s.id === storeId);
            if (store) {
                store.name = document.getElementById('editStoreName').value;
                store.categoryId = document.getElementById('editStoreCategory').value;
                store.admin = document.getElementById('editStoreAdmin').value;
                store.status = document.getElementById('editStoreStatus').value;
                store.description = document.getElementById('editStoreDescription').value;
                store.image = document.getElementById('editStoreImage').value;
                loadAdminStores();
                const editStoreModal = bootstrap.Modal.getInstance(document.getElementById('editStoreModal'));
                editStoreModal.hide();
                showNotification('Tienda actualizada correctamente');
            }
        }
        // Funciones para ver detalles
        function viewProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                document.getElementById('viewProductName').textContent = product.name;
                document.getElementById('viewProductStore').textContent = product.store;
                document.getElementById('viewProductCategory').textContent = categories.find(c => c.id === product.categoryId)?.name || 'Sin categoría';
                document.getElementById('viewProductPrices').innerHTML = `
                    <div>1-10: $${product.price1.toFixed(2)}</div>
                    <div>11-50: $${product.price2.toFixed(2)}</div>
                    <div>51+: $${product.price3.toFixed(2)}</div>
                `;
                document.getElementById('viewProductStock').textContent = product.stock;
                document.getElementById('viewProductDescription').textContent = product.description;
                document.getElementById('viewProductImage').src = product.image;
                const viewProductModal = new bootstrap.Modal(document.getElementById('viewProductModal'));
                viewProductModal.show();
            }
        }
        function viewCategory(categoryId) {
            const category = categories.find(c => c.id === categoryId);
            if (category) {
                document.getElementById('viewCategoryName').textContent = category.name;
                document.getElementById('viewCategoryDescription').textContent = category.description;
                const productCount = products.filter(p => p.categoryId === category.id).length;
                document.getElementById('viewCategoryProducts').textContent = productCount;
                const viewCategoryModal = new bootstrap.Modal(document.getElementById('viewCategoryModal'));
                viewCategoryModal.show();
            }
        }
        function viewCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (customer) {
                document.getElementById('viewCustomerName').textContent = customer.name;
                document.getElementById('viewCustomerEmail').textContent = customer.email;
                document.getElementById('viewCustomerPhone').textContent = customer.phone;
                document.getElementById('viewCustomerStore').textContent = customer.store;
                document.getElementById('viewCustomerOrders').textContent = customer.orders;
                const viewCustomerModal = new bootstrap.Modal(document.getElementById('viewCustomerModal'));
                viewCustomerModal.show();
            }
        }
        function viewAffiliate(affiliateId) {
            const affiliate = affiliates.find(a => a.id === affiliateId);
            if (affiliate) {
                document.getElementById('viewAffiliateName').textContent = affiliate.name;
                document.getElementById('viewAffiliateEmail').textContent = affiliate.email;
                document.getElementById('viewAffiliateStore').textContent = affiliate.store;
                document.getElementById('viewAffiliateCommission').textContent = affiliate.commission + '%';
                document.getElementById('viewAffiliateSales').textContent = affiliate.sales;
                document.getElementById('viewAffiliateStatus').textContent = affiliate.status;
                const viewAffiliateModal = new bootstrap.Modal(document.getElementById('viewAffiliateModal'));
                viewAffiliateModal.show();
            }
        }
        function viewOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                document.getElementById('viewOrderId').textContent = '#' + order.id;
                document.getElementById('viewOrderCustomer').textContent = order.customer;
                document.getElementById('viewOrderStore').textContent = order.store;
                document.getElementById('viewOrderDate').textContent = order.date;
                document.getElementById('viewOrderTotal').textContent = '$' + order.total.toFixed(2);
                document.getElementById('viewOrderStatus').textContent = order.status;
                const viewOrderModal = new bootstrap.Modal(document.getElementById('viewOrderModal'));
                viewOrderModal.show();
            }
        }
        // Funciones para editar
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                document.getElementById('editProductId').value = product.id;
                document.getElementById('editProductName').value = product.name;
                document.getElementById('editProductStore').value = product.storeId;
                document.getElementById('editProductCategory').value = product.categoryId;
                document.getElementById('editProductPrice1').value = product.price1;
                document.getElementById('editProductPrice2').value = product.price2;
                document.getElementById('editProductPrice3').value = product.price3;
                document.getElementById('editProductStock').value = product.stock;
                document.getElementById('editProductDescription').value = product.description;
                document.getElementById('editProductImage').value = product.image;
                const editProductModal = new bootstrap.Modal(document.getElementById('editProductModal'));
                editProductModal.show();
            }
        }
        function editCategory(categoryId) {
            const category = categories.find(c => c.id === categoryId);
            if (category) {
                document.getElementById('editCategoryId').value = category.id;
                document.getElementById('editCategoryName').value = category.name;
                document.getElementById('editCategoryDescription').value = category.description;
                const editCategoryModal = new bootstrap.Modal(document.getElementById('editCategoryModal'));
                editCategoryModal.show();
            }
        }
        function editCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (customer) {
                document.getElementById('editCustomerId').value = customer.id;
                document.getElementById('editCustomerName').value = customer.name;
                document.getElementById('editCustomerEmail').value = customer.email;
                document.getElementById('editCustomerPhone').value = customer.phone;
                document.getElementById('editCustomerStore').value = customer.storeId;
                document.getElementById('editCustomerOrders').value = customer.orders;
                const editCustomerModal = new bootstrap.Modal(document.getElementById('editCustomerModal'));
                editCustomerModal.show();
            }
        }
        function editAffiliate(affiliateId) {
            const affiliate = affiliates.find(a => a.id === affiliateId);
            if (affiliate) {
                document.getElementById('editAffiliateId').value = affiliate.id;
                document.getElementById('editAffiliateName').value = affiliate.name;
                document.getElementById('editAffiliateEmail').value = affiliate.email;
                document.getElementById('editAffiliateStore').value = affiliate.storeId;
                document.getElementById('editAffiliateCommission').value = affiliate.commission;
                document.getElementById('editAffiliateStatus').value = affiliate.status;
                const editAffiliateModal = new bootstrap.Modal(document.getElementById('editAffiliateModal'));
                editAffiliateModal.show();
            }
        }
        function editOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                document.getElementById('editOrderId').value = order.id;
                document.getElementById('editOrderCustomer').value = order.customer;
                document.getElementById('editOrderStore').value = order.storeId;
                document.getElementById('editOrderDate').value = order.date;
                document.getElementById('editOrderTotal').value = order.total;
                document.getElementById('editOrderStatus').value = order.status;
                const editOrderModal = new bootstrap.Modal(document.getElementById('editOrderModal'));
                editOrderModal.show();
            }
        }
        // Funciones para guardar cambios
        function saveProduct() {
            const productId = parseInt(document.getElementById('editProductId').value);
            const product = products.find(p => p.id === productId);
            const storeId = parseInt(document.getElementById('editProductStore').value);
            const store = stores.find(s => s.id === storeId);
            if (product && store) {
                product.name = document.getElementById('editProductName').value;
                product.store = store.name;
                product.storeId = storeId;
                product.categoryId = document.getElementById('editProductCategory').value;
                product.price1 = parseFloat(document.getElementById('editProductPrice1').value);
                product.price2 = parseFloat(document.getElementById('editProductPrice2').value);
                product.price3 = parseFloat(document.getElementById('editProductPrice3').value);
                product.stock = parseInt(document.getElementById('editProductStock').value);
                product.description = document.getElementById('editProductDescription').value;
                product.image = document.getElementById('editProductImage').value;
                loadAdminProducts();
                const editProductModal = bootstrap.Modal.getInstance(document.getElementById('editProductModal'));
                editProductModal.hide();
                showNotification('Producto actualizado correctamente');
            }
        }
        function saveCategory() {
            const categoryId = parseInt(document.getElementById('editCategoryId').value);
            const category = categories.find(c => c.id === categoryId);
            if (category) {
                category.name = document.getElementById('editCategoryName').value;
                category.description = document.getElementById('editCategoryDescription').value;
                loadAdminCategories();
                const editCategoryModal = bootstrap.Modal.getInstance(document.getElementById('editCategoryModal'));
                editCategoryModal.hide();
                showNotification('Categoría actualizada correctamente');
            }
        }
        function saveCustomer() {
            const customerId = parseInt(document.getElementById('editCustomerId').value);
            const customer = customers.find(c => c.id === customerId);
            const storeId = parseInt(document.getElementById('editCustomerStore').value);
            const store = stores.find(s => s.id === storeId);
            if (customer && store) {
                customer.name = document.getElementById('editCustomerName').value;
                customer.email = document.getElementById('editCustomerEmail').value;
                customer.phone = document.getElementById('editCustomerPhone').value;
                customer.store = store.name;
                customer.storeId = storeId;
                customer.orders = parseInt(document.getElementById('editCustomerOrders').value);
                loadAdminCustomers();
                const editCustomerModal = bootstrap.Modal.getInstance(document.getElementById('editCustomerModal'));
                editCustomerModal.hide();
                showNotification('Cliente actualizado correctamente');
            }
        }
        function saveAffiliate() {
            const affiliateId = parseInt(document.getElementById('editAffiliateId').value);
            const affiliate = affiliates.find(a => a.id === affiliateId);
            const storeId = parseInt(document.getElementById('editAffiliateStore').value);
            const store = stores.find(s => s.id === storeId);
            if (affiliate && store) {
                affiliate.name = document.getElementById('editAffiliateName').value;
                affiliate.email = document.getElementById('editAffiliateEmail').value;
                affiliate.store = store.name;
                affiliate.storeId = storeId;
                affiliate.commission = parseFloat(document.getElementById('editAffiliateCommission').value);
                affiliate.status = document.getElementById('editAffiliateStatus').value;
                loadAdminAffiliates();
                const editAffiliateModal = bootstrap.Modal.getInstance(document.getElementById('editAffiliateModal'));
                editAffiliateModal.hide();
                showNotification('Afiliado actualizado correctamente');
            }
        }
        function saveOrder() {
            const orderId = parseInt(document.getElementById('editOrderId').value);
            const order = orders.find(o => o.id === orderId);
            const storeId = parseInt(document.getElementById('editOrderStore').value);
            const store = stores.find(s => s.id === storeId);
            if (order && store) {
                order.customer = document.getElementById('editOrderCustomer').value;
                order.store = store.name;
                order.storeId = storeId;
                order.date = document.getElementById('editOrderDate').value;
                order.total = parseFloat(document.getElementById('editOrderTotal').value);
                order.status = document.getElementById('editOrderStatus').value;
                loadAdminOrders();
                const editOrderModal = bootstrap.Modal.getInstance(document.getElementById('editOrderModal'));
                editOrderModal.hide();
                showNotification('Pedido actualizado correctamente');
            }
        }
        function generateReport(type) {
            switch(type) {
                case 'sales':
                    alert('Generando reporte de ventas...');
                    downloadExcel('Ventas', [
                        { id: 1001, customer: 'Juan Pérez', store: 'TechZone', date: '2023-05-15', total: 149.97, status: 'Entregado' },
                        { id: 1002, customer: 'María García', store: 'FashionStyle', date: '2023-05-16', total: 89.99, status: 'En camino' },
                        { id: 1003, customer: 'Carlos López', store: 'HomeComfort', date: '2023-05-17', total: 299.99, status: 'Procesando' }
                    ]);
                    break;
                case 'products':
                    alert('Generando reporte de productos...');
                    downloadExcel('Productos', products);
                    break;
                case 'affiliates':
                    alert('Generando reporte de afiliados...');
                    downloadExcel('Afiliados', affiliates);
                    break;
                default:
                    alert('Tipo de reporte no válido');
            }
        }
        function generateCustomReport() {
            const type = document.getElementById('reportType').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            if (!startDate || !endDate) {
                alert('Por favor, selecciona un rango de fechas');
                return;
            }
            alert(`Generando reporte personalizado de ${type} desde ${startDate} hasta ${endDate}`);
            switch(type) {
                case 'sales':
                    downloadExcel('Ventas_Personalizado', [
                        { id: 1001, customer: 'Juan Pérez', store: 'TechZone', date: startDate, total: 149.97, status: 'Entregado' },
                        { id: 1002, customer: 'María García', store: 'FashionStyle', date: endDate, total: 89.99, status: 'En camino' }
                    ]);
                    break;
                case 'products':
                    downloadExcel('Productos_Personalizado', products.slice(0, 3));
                    break;
                case 'customers':
                    downloadExcel('Clientes_Personalizado', customers);
                    break;
                case 'affiliates':
                    downloadExcel('Afiliados_Personalizado', affiliates);
                    break;
            }
        }
        function downloadExcel(sheetName, data) {
            const workbook = new ExcelJS.Workbook();
            const worksheet = workbook.addWorksheet(sheetName);
            const headers = Object.keys(data[0]);
            worksheet.addRow(headers);
            worksheet.getRow(1).eachCell((cell) => {
                cell.font = { bold: true };
                cell.fill = {
                    type: 'pattern',
                    pattern: 'solid',
                    fgColor: { argb: 'FFD4AF37' }
                };
            });
            data.forEach(item => {
                const row = headers.map(header => item[header]);
                worksheet.addRow(row);
            });
            worksheet.columns.forEach(column => {
                let maxLength = 0;
                column.eachCell({ includeEmpty: true }, cell => {
                    const columnLength = cell.value ? cell.value.toString().length : 10;
                    if (columnLength > maxLength) {
                        maxLength = columnLength;
                    }
                });
                column.width = maxLength < 10 ? 10 : maxLength;
            });
            workbook.xlsx.writeBuffer().then(buffer => {
                const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                saveAs(blob, `Reporte_${sheetName}_${new Date().toISOString().slice(0,10)}.xlsx`);
            });
        }
        function importStores() {
            const fileInput = document.getElementById('storesFile');
            const file = fileInput.files[0];
            if (!file) {
                alert('Por favor, selecciona un archivo para importar');
                return;
            }
            alert(`Importando tiendas desde: ${file.name}`);
            setTimeout(() => {
                showNotification('Tiendas importadas correctamente');
                loadAdminStores();
                fileInput.value = '';
            }, 2000);
        }
        function importProducts() {
            const fileInput = document.getElementById('productsFile');
            const file = fileInput.files[0];
            if (!file) {
                alert('Por favor, selecciona un archivo para importar');
                return;
            }
            alert(`Importando productos desde: ${file.name}`);
            setTimeout(() => {
                showNotification('Productos importados correctamente');
                loadAdminProducts();
                fileInput.value = '';
            }, 2000);
        }
        function importCategories() {
            const fileInput = document.getElementById('categoriesFile');
            const file = fileInput.files[0];
            if (!file) {
                alert('Por favor, selecciona un archivo para importar');
                return;
            }
            alert(`Importando categorías desde: ${file.name}`);
            setTimeout(() => {
                showNotification('Categorías importadas correctamente');
                loadAdminCategories();
                fileInput.value = '';
            }, 2000);
        }
        function importCustomers() {
            const fileInput = document.getElementById('customersFile');
            const file = fileInput.files[0];
            if (!file) {
                alert('Por favor, selecciona un archivo para importar');
                return;
            }
            alert(`Importando clientes desde: ${file.name}`);
            setTimeout(() => {
                showNotification('Clientes importados correctamente');
                loadAdminCustomers();
                fileInput.value = '';
            }, 2000);
        }
        function importAffiliates() {
            const fileInput = document.getElementById('affiliatesFile');
            const file = fileInput.files[0];
            if (!file) {
                alert('Por favor, selecciona un archivo para importar');
                return;
            }
            alert(`Importando afiliados desde: ${file.name}`);
            setTimeout(() => {
                showNotification('Afiliados importados correctamente');
                loadAdminAffiliates();
                fileInput.value = '';
            }, 2000);
        }
        function initializeCharts() {
            const salesChartElement = document.getElementById('salesChart');
            const categoriesChartElement = document.getElementById('categoriesChart');
            if (salesChartElement && categoriesChartElement) {
                const salesCtx = salesChartElement.getContext('2d');
                new Chart(salesCtx, {
                    type: 'line',
                    data: {
                        labels: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'],
                        datasets: [{
                            label: 'Ventas ($)',
                            data: [1200, 1900, 1500, 2100, 1800, 2500, 2200],
                            borderColor: '#D4AF37',
                            backgroundColor: 'rgba(212, 175, 55, 0.1)',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        }
                    }
                });
                const categoriesCtx = categoriesChartElement.getContext('2d');
                new Chart(categoriesCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Electrónica', 'Ropas', 'Hogar', 'Deportiva'],
                        datasets: [{
                            data: [40, 25, 20, 15],
                            backgroundColor: [
                                '#D4AF37',
                                '#B8860B',
                                '#8B4513',
                                '#654321'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            }
                        }
                    }
                });
            }
        }
		function loginAsOwner() {
			isAdminLoggedIn = true;
			currentUser = {
				id: 1,
				name: 'Propietario',
				email: 'propietario@pati.com',
				role: 'propietario'
			};
			document.getElementById('mainContent').classList.add('d-none');
			document.getElementById('adminPanel').classList.remove('d-none');
			document.getElementById('authButtons').classList.add('d-none');
			document.getElementById('logoutButton').classList.remove('d-none');
			loadAdminData();
			showNotification('Has iniciado sesión como Propietario');
		}
    </script>
</body>
</html>